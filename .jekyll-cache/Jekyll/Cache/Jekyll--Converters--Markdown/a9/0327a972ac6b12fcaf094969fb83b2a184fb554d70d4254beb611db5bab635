I"à<p>ä»¥å‰å­¦ C++ çš„æ—¶å€™ï¼Œæ€»æ˜¯å¬è¯´å¯ä»¥ç”¨ç»§æ‰¿å’ŒåŸºç±»æŒ‡é’ˆå»æ‰©å±•ä¸šåŠ¡é€»è¾‘ï¼Œè€Œå¯¹æ•´ä½“ç³»ç»Ÿæ¶æ„çš„ä¾µå…¥å¾ˆå°ã€‚å…¶å®å¯¹è¿™é‡Œç†è§£å¹¶ä¸æ·±ã€‚æœ€è¿‘åœ¨çœ‹å…¶ä»–åŒå­¦å†™çš„æœç´¢å¼•æ“æ–°æ¡†æ¶æ—¶ï¼Œå‘ç°è¿™ç§è®¾è®¡å¯ä»¥å°†ç³»ç»Ÿæ¡†æ¶å’Œä¸šåŠ¡é€»è¾‘å®Œå…¨è§£è€¦å¼€ã€‚äºæ˜¯å†³å®šå®ç°ä¸€ä¸‹ã€‚</p>

<hr />

<h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2>

<pre><code class="language-C">class BaseModule
{
public:
	virtual ~BaseModule(); 

	virtual string GetData();
};

class BusinessModuleA: public BaseModule
{
public:
	virtual string GetData(); // å–å‡º 00700.HK
};

class BusinessModuleB: public BaseModule
{
public:
	virtual string GetData(); // ç­¾ä¸‹ Playerunknown's Battlegrounds
};

int main 
{
	// PartAï¼Œä½¿ç”¨ ModuleA å¤„ç† 
	BaseModule * module_a = new BusinessModuleA();
	cout &lt;&lt; module_a-&gt;GetData() &lt;&lt; endl;

	// PartBï¼Œä½¿ç”¨ ModuleB å¤„ç† 
	BaseModule * module_b = new BusinessModuleB();
	cout &lt;&lt; module_b-&gt;GetData() &lt;&lt; endl;
}
</code></pre>

<p>å…ˆå®šä¹‰ä¸€ä¸ª BaseModule ç±»ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªè™šæˆå‘˜å‡½æ•° GetData()ï¼Œå®ƒè´Ÿè´£å¤„ç†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨ BaseModule ä¸­ä¸å®ç°ã€‚å†å®šä¹‰ä¸€ä¸ª BusinessModuleA ç±»ï¼Œå®ƒç»§æ‰¿è‡ª BaseModule ç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†è‡ªå·±çš„ GetData() æ–¹æ³•ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å–å‡ºæ‰€æœ‰çš„ 00700.HKï¼Œå¹¶è¿”å›å½“å¤©çš„æ”¶ç›Šã€‚åŒç†ï¼Œå†å®šä¹‰ä¸€ä¸ª BusinessModuleB ç±»ï¼Œå®ƒä¹Ÿå®ç°äº†è‡ªå·±çš„ GetData() æ–¹æ³•ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ç­¾ä¸‹ã€ŒPlayerunknownâ€™s Battlegroundsã€ï¼Œå¹¶è¿”å›åœ¨å›½æœä¸Šçº¿çš„æ—¥æœŸã€‚</p>

<p>åœ¨ä½¿ç”¨æ—¶ï¼Œç”¨ä¸¤ä¸ªåŸºç±»æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘æ–°å»ºçš„ BusinessModuleAã€BusinessModuleB å®ä¾‹ã€‚ä¸ºä»€ä¹ˆç”¨åŸºç±»æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºåŸºç±»æŒ‡é’ˆçš„å‘½åï¼ˆå°½ç®¡å­ç±»åä¸åŒï¼Œä½†åŸºç±»æŒ‡é’ˆéƒ½æ˜¯ä¸€ä¸ªåï¼‰å’Œè¡Œä¸ºï¼ˆè°ƒç”¨è™šæˆå‘˜å‡½æ•°ï¼‰æ˜¯ç»Ÿä¸€çš„ï¼Œåœ¨ module_a-&gt;GetData() è¿›è¡Œè°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å»åˆ†è¾¨åˆ°åº•ä½¿ç”¨å“ªä¸ªå­ç±»çš„æ–¹æ³•ã€‚</p>

<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†åªå« PartA çš„ä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶æ”¾åœ¨ mmstock1 çº¿ä¸Šæœºå™¨ä¸Šä½œä¸ºè‚¡ç¥¨ä¸šåŠ¡çš„æœåŠ¡ï¼Œå°†åªå«æœ‰ PartB çš„ä»£ç ç”Ÿæˆçš„äºŒè¿›åˆ¶æ”¾åœ¨ mmgame1 æœºå™¨ä¸Šä½œä¸ºæ¸¸æˆä¸šåŠ¡çš„æœåŠ¡ã€‚å¦‚æœä»…ä»…æ˜¯è¿™æ ·ä¼¼ä¹æ²¡æœ‰å¿…è¦æè¿™ä¹ˆå¤æ‚ï¼Œå•ç‹¬åˆ†å¼€å»å†™ä»£ç ä¹Ÿå¯ä»¥ã€‚
ä½†å¦‚æœ BaseModule ç±»ä¸­è¿˜æœ‰å…¶ä»–å¤§é‡çš„é€»è¾‘ï¼Œæ¯”å¦‚å¤„ç†ç½‘ç»œè¿æ¥ã€ç›‘æ§æœåŠ¡çŠ¶æ€ã€æ”¶é›†é”™è¯¯æ—¥å¿—å‘¢ã€‚è¿™äº›å…¬ç”¨çš„æ–¹æ³•è¢«æ”¾åœ¨äº†åŸºç±»ä¸­ï¼Œè€Œç‹¬ç‰¹çš„ä¸šåŠ¡é€»è¾‘è¢«æŠ½å‡ºæ¥æ”¾åœ¨äº†å„è‡ªçš„å­ç±»é‡Œã€‚</p>

<p>ç°åœ¨æ–°å¼€å±•ä¸€ä¸ªä¸šåŠ¡ï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿ BaseModuleï¼Œåœ¨ GetData() ç±»ä¸­å®ç°ä¸šåŠ¡ï¼Œæœ€ååœ¨ main å‡½æ•°ä¸­ä¿®æ”¹ä¸º new è¿™ä¸ªå­ç±»å³å¯ã€‚</p>

<p>ä½†è¿™ç§æ–¹å¼æœ‰ä¸€äº›é—®é¢˜ï¼Œ</p>

<p>1ã€éœ€è¦åœ¨å…¥å£æ–‡ä»¶ä¸­æ·»åŠ æ–°å¢ä¸šåŠ¡çš„å¤´æ–‡ä»¶</p>

<p>2ã€main æ–¹æ³•ä¸­çš„ä»£ç æ˜¯å±äºç³»ç»Ÿæ¡†æ¶çš„ï¼Œä¸èƒ½æ¯æ¬¡æ–°å¢ä¸šåŠ¡éƒ½å»æ”¹åŠ¨æ¡†æ¶ä»£ç </p>

<hr />

<h2 id="è¿˜æ˜¯åŸºæœ¬æ“ä½œ">è¿˜æ˜¯åŸºæœ¬æ“ä½œ</h2>

<p>å› è€Œéœ€è¦å¼•å…¥åå°„æœºåˆ¶æ¥æ”¹å–„ä¸Šé¢çš„ç¼ºç‚¹ï¼Œæ•´ä¸ª repo ä½äº <a href="https://github.com/Huangtuzhi/code-gist/tree/master/Cpp/how-to-extend-business">how-to-extend-business</a>ã€‚è¿˜æ˜¯åŸºæœ¬æ“ä½œï¼Œéƒ½åä¸‹ã€‚</p>

<p>ä»£ç ç›®å½•å¦‚ä¸‹ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ä»£ç éƒ½æ”¾åœ¨ business_logic ç›®å½•ä¸‹ï¼Œentrance.cpp å’Œ base_module.cpp åˆ†åˆ«æ˜¯ç³»ç»Ÿæ¡†æ¶çš„ main å‡½æ•°å…¥å£å’ŒåŸºç±»ï¼Œè¿™éƒ¨åˆ†åœ¨ä¸šåŠ¡å˜æ›´æ—¶æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
â””â”€â”€how-to-extend-business
    â”œâ”€â”€ entrance.cpp    # ç›¸å½“äºç³»ç»Ÿæ¡†æ¶çš„ main å‡½æ•°å…¥å£
    â”œâ”€â”€ base_module.cpp # ç›¸å½“äºç³»ç»Ÿæ¡†æ¶çš„åŸºç±»
    â”œâ”€â”€ base_module.h
    â”œâ”€â”€ business_logic  # æ‰©å±•çš„ä¸šåŠ¡é€»è¾‘ç›®å½•
    â”‚Â Â  â”œâ”€â”€ business_a.cpp
    â”‚Â Â  â”œâ”€â”€ business_a.h
    â”‚Â Â  â”œâ”€â”€ business_b.cpp
    â”‚Â Â  â””â”€â”€ business_b.h
    â”œâ”€â”€ make.sh         # ç¼–è¯‘è„šæœ¬
    â””â”€â”€ reflection      # åå°„å®
        â”œâ”€â”€ class_register.h
        â”œâ”€â”€ class_register_test.cc
        â”œâ”€â”€ class_register_test_helper.cc
        â””â”€â”€ class_register_test_helper.h
</code></pre></div></div>

<p>C++ æœ¬èº«ä¸æ”¯æŒåå°„ï¼Œåªèƒ½å»æ¨¡æ‹Ÿè¿™ç§æœºåˆ¶ï¼Œå³ç”¨ç±»åå»è·å–ç±»çš„å®ä¾‹ã€‚éœ€è¦åšåˆ°ä¸‹é¢ä¸‰æ–¹é¢ï¼š</p>

<p>1ã€æœ‰ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå…¶æˆå‘˜å˜é‡ map&lt;string, Creator&gt; m_creator_registry å­˜æ”¾ï¼ˆç±»åï¼Œåˆ›å»ºå¯¹åº”ç±»å®ä¾‹çš„å‡½æ•°æŒ‡é’ˆï¼‰</p>

<p>2ã€æ¯ä¸€ä¸ªç‹¬ç«‹ä¸šåŠ¡çš„å­ç±»ä¸­ï¼Œå®ç°è‡ªå·±çš„ Creatorï¼Œå³è¿”å›å­ç±»å®ä¾‹çš„å‡½æ•°</p>

<p>3ã€æ¯ä¸€ä¸ªç‹¬ç«‹ä¸šåŠ¡çš„å­ç±»ä¸­ï¼Œå‘ m_creator_registry æ³¨å†Œ</p>

<p>è¿™éƒ¨åˆ†åŠŸèƒ½åœ¨ reflection ç›®å½•ä¸­ç”±å®å®šä¹‰æ¥å®ç°ï¼Œä½¿ç”¨ 
gcc -E -C business_a.cpp &gt; out.txt æŸ¥çœ‹</p>

<p>REGISTER_MODULE(BusinessModuleA, â€œBusinessModuleAâ€) è¿™ä¸€è¡Œ</p>

<p>å®å±•å¼€åçš„ç»“æœï¼Œå°±æ˜¯å®ç°äº† 2 å’Œ 3 ä¸¤éƒ¨åˆ†ã€‚</p>

<pre><code class="language-C">BaseModule* ObjectCreator_register_name_BusinessModuleA()
{ 
	return new BusinessModuleA; 
} 

ObjectCreatorRegister_ModuleRegister 
g_object_creator_register_name_BusinessModuleA("BusinessModuleA",
ObjectCreator_register_name_BusinessModuleA);
</code></pre>

<p>è¿™æ ·æ”¹é€ ä»¥åï¼Œæ–°å¢ä¸šåŠ¡æ—¶åªéœ€è¦åœ¨ business_logic ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿ BaseModuleï¼Œåœ¨ GetData() ä¸­å®ç°ä¸šåŠ¡ï¼Œåœ¨æœ€ååŠ ä¸Š REGISTER_MODULE å®ã€‚</p>

<hr />

<h2 id="åŠ¨æ€é…ç½®">åŠ¨æ€é…ç½®</h2>

<p>åœ¨ä»£ç çš„ main å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ä¾ç„¶è¦æŒ‡å®š GET_MODULE ä¸­çš„ç±»å</p>

<pre><code class="language-C">// ä½¿ç”¨åå°„è·å– ModuleA å®ä¾‹
BaseModule* business_a = GET_MODULE("BusinessModuleA");
cout &lt;&lt; business_a-&gt;GetData() &lt;&lt; endl;

// ä½¿ç”¨åå°„è·å– ModuleB å®ä¾‹
BaseModule* business_b = GET_MODULE("BusinessModuleB");
cout &lt;&lt; business_b-&gt;GetData() &lt;&lt; endl;
</code></pre>

<p>æ€æ ·æ‰èƒ½å®Œå…¨ä¸ä¿®æ”¹ç³»ç»Ÿæ¡†æ¶å‘¢ï¼Ÿ</p>

<p>å¯ä»¥å†åŠ å…¥ä¸€ä¸ªé…ç½®ç±»ï¼Œé…ç½®ç±»å»è¯»å–æœåŠ¡å™¨æŒ‡å®šè·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ¨æ€ä¿®æ”¹ç±»åäº†ï¼Œæ–°å¢ä¸€ä¸ªä¸šåŠ¡ï¼Œä¿®æ”¹ä¸€ä¸‹é…ç½®é¡¹å³å¯ã€‚</p>

<hr />

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<p><a href="https://mp.weixin.qq.com/s/FREXun1jWP5zH4prVEVO6Q">PUBG</a></p>

<p><a href="https://www.futunn.com/quote/stock?m=hk&amp;code=00700">00700.HK</a></p>

<p><a href="http://www.cnblogs.com/cycxtz/p/4871927.html">C++ å®ç°é€šè¿‡ç±»åæ¥è¿›è¡Œå®ä¾‹åŒ–</a></p>

<p><a href="http://www.cnblogs.com/xudong-bupt/p/6643721.html">C++ åå°„æœºåˆ¶çš„ç®€å•å®ç°</a></p>

:ET