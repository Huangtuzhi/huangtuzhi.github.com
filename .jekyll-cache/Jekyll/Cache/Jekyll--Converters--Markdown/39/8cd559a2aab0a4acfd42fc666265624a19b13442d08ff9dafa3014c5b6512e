I"à	<p>S3C2440åœ¨å†…æ ¸ç‰ˆæœ¬2.6.34ä¸‹å¼€å‘ADCé©±åŠ¨æ—¶ï¼Œä¼šå‘ç°é©±åŠ¨ç¨‹åºé‡Œç”¨äº†äº’æ–¥é€šä¿¡æ¥å®ç°åŒæ­¥ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!-- lang: cpp --&gt;
DECLARE_MUTEX(ADC_LOCK);
static int OwnADC = 0; åœ¨wikipediaä¸­å¼è¿™ä¹ˆå®šä¹‰Mutex Exclusionçš„ï¼š
</code></pre></div></div>

<blockquote>
  <p>In computer science, mutual exclusion refers to the requirement of ensuring that no two processes or threads (henceforth referred to only as processes) are in their critical section at the same time. Here, a critical section refers to a period of time when the process accesses a shared resource, such as shared memory.</p>
</blockquote>

<p>ä¸“ä¸šçš„è¡¨è¾¾ä¹Ÿå¯ä»¥æ˜¯è¿™æ ·:</p>
<blockquote>
  <p>A data structure for mutual exclusion, also known as a binary semaphore. A mutex is basically just a multitasking-aware binary flag that can be used to synchronize the activities of multiple tasks. As such, it can be used to protect critical sections of the code from interruption and shared resources from simultaneous use.</p>
</blockquote>

<p>äº’æ–¥ä½“æ˜¯è¡¨ç°äº’æ–¥ç°è±¡çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿè¢«å½“ä½œäºŒå…ƒä¿¡å·ç¯ã€‚ä¸€ä¸ªäº’æ–¥åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡æ•æ„Ÿçš„äºŒå…ƒä¿¡å·ï¼Œå®ƒèƒ½ç”¨ä½œåŒæ­¥å¤šä»»åŠ¡çš„è¡Œä¸ºï¼Œå®ƒå¸¸ç”¨ä½œä¿æŠ¤ä»ä¸­æ–­æ¥çš„ä¸´ç•Œæ®µä»£ç å¹¶ä¸”åœ¨å…±äº«åŒæ­¥ä½¿ç”¨çš„èµ„æºã€‚</p>

<hr />
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>Linuxå†…æ ¸çš„åŒæ­¥æœºåˆ¶é‡Œé¢ï¼š
è¾…åŠ©å®:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!-- lang: cpp --&gt;
DECLARE_MUTEX(name); /*å£°æ˜ä¸€ä¸ªäº’æ–¥é”ï¼ŒæŠŠåä¸ºnameçš„ä¿¡å·é‡å˜é‡åˆå§‹åŒ–ä¸º1 */
DECLARE_MUTEX_LOCKED(name); /* å£°æ˜ä¸€ä¸ªäº’æ–¥é”ï¼ŒæŠŠåä¸ºnameçš„ä¿¡å·é‡å˜é‡åˆå§‹åŒ–ä¸º0 */
</code></pre></div></div>

<p>åœ¨Linuxä¸–ç•Œä¸­, På‡½æ•°è¢«ç§°ä¸ºdown, æŒ‡çš„æ˜¯è¯¥å‡½æ•°å‡å°äº†ä¿¡å·é‡çš„å€¼, å®ƒä¹Ÿè®¸ä¼šå°†è°ƒç”¨è€…ç½®äºä¼‘çœ çŠ¶æ€, ç„¶åç­‰å¾…ä¿¡å·é‡å˜å¾—å¯ç”¨, ä¹‹åå†æˆäºˆè°ƒç”¨è€…å¯¹è¢«ä¿æŠ¤èµ„æºçš„è®¿é—®æƒé™.</p>

<p>void down(struct semaphore *sem);</p>

<p>å½“ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè°ƒç”¨downå‡½æ•°å, å°±ç§°ä¸ºè¯¥çº¿ç¨‹æ‹¥æœ‰äº†è¯¥ä¿¡å·é‡, å¯ä»¥è®¿é—®è¢«è¯¥ä¿¡å·é‡ä¿æŠ¤çš„ä¸´ç•ŒåŒº. å½“äº’æ–¥æ“ä½œå®Œæˆå, å¿…é¡»é‡Šæ”¾è¯¥ä¿¡å·é‡.
Linuxçš„Vå‡½æ•°æ˜¯up:</p>

<p>void up(struct semaphore *sem)</p>

<p>è°ƒç”¨upä¹‹å, è°ƒç”¨è€…ä¸å†æ‹¥æœ‰è¯¥ä¿¡å·é‡</p>

<h2 id="reference">Reference</h2>
<p>[1].Linux Device Drivers.Thirth Edition.P112-P114</p>

:ET