---
layout: post
title: "Redis分析"
description: ""
category: c&&c++
tags: []
---

Redis是一种NoSQL的基于内存的key-value数据库。数据存储在内存和硬盘上，Redis周期性把更新数据写入磁盘，把修改操作写入追加记录文件中。

----------------------------------------------

##安装配置##
1. 在[官网](http://redis.io/download)下载源码。

2.解压后进入目录make即可。

/src下的redis-server和redis-cli分别是服务器和客户端应用程序，可直接调用。运行命令到用户bin目录下方便调用：

`cp src/redis-* /usr/local/bin`

服务器运行界面如下：
![图片](/assets/images/redis-1.png)

客户端运行如下：
![图片](/assets/images/redis-2.png)

-----------------------------------------------------

##数据类型##
Redis一共有五种数据类型：string，hash，list，set，zset。

string由sds.h/sds.c表示：

```
typedef char *sds;
//结构提定义，len为数组长度，free为空闲大小。
struct sdshdr {
    unsigned int len;
    unsigned int free;
    char buf[];
};

//内存向高地址增长，s是字符数组实际位置。得到结构体首地址，然后运算符取得string大小。
static inline size_t sdslen(const sds s) {
    struct sdshdr *sh = (void*)(s-(sizeof(struct sdshdr)));
    return sh->len;
}
```
string由adlist.h/adlist.c表示：

```
//可见list是一个双向链表
typedef struct listNode {
    struct listNode *prev;
    struct listNode *next;
    void *value;
} listNode;

//遍历迭代器
typedef struct listIter {
    listNode *next;
    int direction;
} listIter;

//定义一个head和tail，把list放在中间。
typedef struct list {
    listNode *head;
    listNode *tail;
//典型的函数指针，同OOP成员函数
    void *(*dup)(void *ptr);
    void (*free)(void *ptr);
    int (*match)(void *ptr, void *key);
    unsigned long len;
} list;

```
match采用遍历，算法复杂度为0(n)。对比[LRU缓存机制](
http://tuzhii.com/2014/11/20/RCU/)应用hashmap的0(1)算法。

hash由dict.h/dict.c表示：

(TBD)


----------------------------------------------------

##Reference##
[1].http://my.oschina.net/lvyi/blog/361141

[2].http://redisbook.readthedocs.org/en/latest/internal/redis.html
